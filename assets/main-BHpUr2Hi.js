import{c as v,b as N,a as Q,d as V,s as _}from"./gui-D4lZ3Mi3.js";function $(t,e,l){const i=t.getContext("2d");let n=i.createImageData(t.width,t.height),o=n.data,p=null,c=t.width/e.boundsSize.x,y=t.width*.5,m=t.height*.5,r=-1,d=[];function U(){const a=t.getBoundingClientRect(),u=window.devicePixelRatio||1,f=Math.max(1,Math.round(a.width*u)),w=Math.max(1,Math.round(a.height*u));if(p===null){const h=Math.max(1,a.width);p=e.boundsSize.x/h}(t.width!==f||t.height!==w)&&(t.width=f,t.height=w,n=i.createImageData(t.width,t.height),o=n.data),e.boundsSize={x:t.width/u*p,y:t.height/u*p},c=t.width/e.boundsSize.x,y=t.width*.5,m=t.height*.5}function M(a,u){return{x:y+a*c,y:m-u*c}}function E(a,u){const f=window.devicePixelRatio||1,w=a*f,h=u*f;return{x:(w-y)/c,y:(m-h)/c}}function q(){const a=window.devicePixelRatio||1,u=Math.max(1,Math.round(e.particleRadius*a));if(u===r)return;r=u;const f=[],w=r*r;for(let h=-r;h<=r;h+=1)for(let x=-r;x<=r;x+=1)x*x+h*h<=w&&f.push([x,h]);d=f}function T(a){const u=t.width,f=t.height;o.fill(0);const w=[5,7,11];for(let s=0;s<o.length;s+=4)o[s]=w[0],o[s+1]=w[1],o[s+2]=w[2],o[s+3]=255;const h=e.velocityDisplayMax;q();for(let s=0;s<a.count;s+=1){const g=a.positions[s*2],S=a.positions[s*2+1],k=M(g,S),H=a.velocities[s*2],O=a.velocities[s*2+1],X=Math.sqrt(H*H+O*O),Y=Math.max(0,Math.min(1,X/h)),B=Math.min(l.length-1,Math.floor(Y*(l.length-1))),P=l[B],G=Math.round(P.r*255),K=Math.round(P.g*255),j=Math.round(P.b*255),Z=Math.round(k.x),J=Math.round(k.y);for(let F=0;F<d.length;F+=1){const W=d[F],R=J+W[1];if(R<0||R>=f)continue;const C=Z+W[0];if(C<0||C>=u)continue;const A=(R*u+C)*4;o[A]=G,o[A+1]=K,o[A+2]=j,o[A+3]=255}}i.putImageData(n,0,0);const x=e.boundsSize.x*c/2,D=e.boundsSize.y*c/2;if(i.strokeStyle="#1b2432",i.lineWidth=1,i.strokeRect(y-x,m-D,x*2,D*2),e.obstacleSize.x>0&&e.obstacleSize.y>0){const s=e.obstacleSize.x*c/2,g=e.obstacleSize.y*c/2,S=M(e.obstacleCentre.x,e.obstacleCentre.y);i.strokeStyle="#36516d",i.strokeRect(S.x-s,S.y-g,s*2,g*2)}}return U(),window.addEventListener("resize",U),{draw:T,worldToCanvas:M,canvasToWorld:E,getScale:()=>c}}function tt(t){const e=t.count;return{positions:t.positions,predicted:new Float32Array(t.positions),velocities:t.velocities,densities:new Float32Array(e*2),keys:new Uint32Array(e),sortedKeys:new Uint32Array(e),indices:new Uint32Array(e),sortOffsets:new Uint32Array(e),spatialOffsets:new Uint32Array(e),positionsSorted:new Float32Array(e*2),predictedSorted:new Float32Array(e*2),velocitiesSorted:new Float32Array(e*2),count:e,input:{worldX:0,worldY:0,pull:!1,push:!1}}}function et(t,e,l){const i=n=>{const o=t.getBoundingClientRect(),p=n.clientX-o.left,c=n.clientY-o.top,y=e(p,c);l.worldX=y.x,l.worldY=y.y};t.addEventListener("pointermove",i),t.addEventListener("pointerdown",n=>{i(n),n.button===0&&(l.pull=!0),n.button===2&&(l.push=!0)}),t.addEventListener("pointerup",n=>{n.button===0&&(l.pull=!1),n.button===2&&(l.push=!1)}),t.addEventListener("pointerleave",()=>{l.pull=!1,l.push=!1}),t.addEventListener("contextmenu",n=>{n.preventDefault()})}function it(t){const e=V(),l=v(e),i=tt(l),n=N(e.colorKeys,e.gradientResolution),o=$(t,e,n);et(t,o.canvasToWorld,i.input);const p=Q(i,e,o.getScale);function c(){const r=v(e),d=r.count;i.positions=r.positions,i.predicted=new Float32Array(r.positions),i.velocities=r.velocities,i.densities=new Float32Array(d*2),i.keys=new Uint32Array(d),i.sortedKeys=new Uint32Array(d),i.indices=new Uint32Array(d),i.sortOffsets=new Uint32Array(d),i.spatialOffsets=new Uint32Array(d),i.positionsSorted=new Float32Array(d*2),i.predictedSorted=new Float32Array(d*2),i.velocitiesSorted=new Float32Array(d*2),i.count=d}function y(r){p.step(r)}function m(){o.draw(i)}return{step:y,draw:m,state:i,config:e,refreshSettings:p.refreshSettings,applyParticleScale:p.applyParticleScale,reset:c}}document.querySelector("#app").innerHTML=`
  <canvas id="sim-canvas" aria-label="Fluid simulation"></canvas>
`;const nt=document.querySelector("#sim-canvas"),b=it(nt),{stats:z}=_(b.config,{onReset:()=>b.reset(),onSmoothingRadiusChange:()=>b.refreshSettings()},{trackGPU:!1,title:"Canvas 2D Fluid",subtitle:"SPH Fluid â€¢ Particle Simulation",features:["SPH Fluid Simulator","Canvas 2D Rendering","Direct Pixel Manipulation","Spatial Grid Optimization","Box Obstacle Interaction"],interactions:["Click & Drag: Pull Particles","Right Click & Drag: Push Particles","Mouse Wheel: Zoom In/Out"],githubUrl:"https://github.com/jeantimex/fluid"});let I=performance.now();function L(t){z.begin();const e=Math.min(.033,(t-I)/1e3);I=t,b.step(e),b.draw(),z.end(),z.update(),requestAnimationFrame(L)}requestAnimationFrame(L);
