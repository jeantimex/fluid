import"./lil-gui.esm-DA0aiWCL.js";import{O as y,s as F,c as v,a as C,i as R,W as x,b as m,d as M}from"./picking_system-DXizyZhd.js";import{F as D}from"./fluid_simulation-BTN9i4fw.js";import"./main-DwTz-q1_.js";import"./environment-ODazOT3W.js";import"./splat_resolve-CMJnQc1h.js";function W(e){e.innerHTML='<canvas id="sim-canvas" aria-label="Fluid simulation"></canvas>';const a=document.querySelector("#sim-canvas");if(!a)throw new Error("Failed to create canvas element");return a}const f=document.querySelector("#app");if(!f)throw new Error("Missing #app container");const s=W(f),i={...C(),...v(),viscosityStrength:.01,iterationsPerFrame:2,velocityDisplayMax:8,gradientResolution:50,densityTextureRes:150,densityOffset:0,densityMultiplier:.02,lightStepSize:.1,shadowSoftness:2.5,sceneExposure:1,extinctionCoefficients:{x:2.12,y:.43,z:.3},showBoundsWireframe:!1,boundsWireframeColor:{r:1,g:1,b:1},showFluidShadows:!0,colorKeys:[{t:4064/65535,r:.13363299,g:.34235913,b:.7264151},{t:33191/65535,r:.2980392,g:1,b:.56327766},{t:46738/65535,r:1,g:.9309917,b:0},{t:1,r:.96862745,g:.28555763,b:.031372573}]};let n=null;const l=new y;l.radius=30;l.theta=Math.PI/6;l.phi=Math.PI/2.5;const{stats:p,gui:c}=F(i,{onReset:()=>n?.reset(),onSmoothingRadiusChange:()=>{}},{trackGPU:!0,title:"WebGPU 3D Fluid",subtitle:"SPH Fluid â€¢ Particle Simulation",features:["SPH Fluid Simulator (GPU)","Billboard Particle Rendering","Frustum Culling","Dynamic Shadow Mapping","Precise Particle Interaction","Box/Sphere Obstacles"],interactions:["Click & Drag (Background): Orbit Camera","Click & Drag (Fluid): Pull Particles","Shift + Click & Drag: Push Particles","Mouse Wheel: Zoom In/Out"],githubUrl:"https://github.com/jeantimex/fluid"}),P=c.folders.find(e=>e._title==="Particles");P&&P.add(i,"particleRadius",1,5,.1).name("Particle Radius");const o=c.folders.find(e=>e._title==="Shadow");o&&(o.add(i,"densityTextureRes",32,256,1).name("Volume Res").onFinishChange(()=>n?.reset()),o.add(i,"densityOffset",0,500,1).name("Density Offset"),o.add(i,"densityMultiplier",0,.2,.001).name("Density Multiplier"),o.add(i,"lightStepSize",.01,.5,.01).name("Light Step"),o.add(i,"showFluidShadows").name("Fluid Shadows"));let h;const r={paused:!1,togglePause:()=>{r.paused=!r.paused,h&&h.name(r.paused?"Resume":"Pause")},reset:()=>n?.reset()};h=c.add(r,"togglePause").name(r.paused?"Resume":"Pause");c.add(r,"reset").name("Reset Simulation");async function O(){let e,a,d;try{({device:e,context:a,format:d}=await R(s))}catch(t){if(t instanceof x){f.innerHTML=`<p>${t.message}</p>`;return}throw t}m(a,e,d),n=new D(e,a,s,i,d);const S=M(s,()=>n?.simulationState.input,l,i);window.addEventListener("resize",()=>{const t=window.devicePixelRatio||1;s.width=window.innerWidth*t,s.height=window.innerHeight*t,m(a,e,d)});const g=window.devicePixelRatio||1;s.width=window.innerWidth*g,s.height=window.innerHeight*g,m(a,e,d);let u=null;const w=async t=>{u===null&&(u=t),p.begin();const b=Math.min(.033,(t-u)/1e3);u=t,S(),n&&(r.paused||await n.step(b),n.render(l.viewMatrix)),p.end(),p.update(),requestAnimationFrame(w)};requestAnimationFrame(w)}O();
