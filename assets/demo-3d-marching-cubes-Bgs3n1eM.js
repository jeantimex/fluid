import"./lil-gui.esm-DA0aiWCL.js";import{O as F,s as v,r as M,h as R,c as x,a as y,i as I,W as T,b as m,d as W}from"./picking_system-CJTWpPbq.js";import{F as D}from"./fluid_simulation-D_19OtFq.js";import"./main-DwTz-q1_.js";import"./environment-ODazOT3W.js";import"./splat_resolve-CMJnQc1h.js";function H(e){e.innerHTML='<canvas id="sim-canvas" aria-label="Fluid simulation"></canvas>';const a=document.querySelector("#sim-canvas");if(!a)throw new Error("Failed to create canvas element");return a}const g=document.querySelector("#app");if(!g)throw new Error("Missing #app container");const r=H(g),t={...y(),...x(),viscosityStrength:.01,iterationsPerFrame:2,nearPressureMultiplier:2.25,densityTextureRes:150,isoLevel:75,surfaceColor:{r:15/255,g:91/255,b:234/255},shadowSoftness:2.5,showFluidShadows:!0,showBoundsWireframe:!1,boundsWireframeColor:{r:1,g:1,b:1}};let n=null;const d=new F;d.radius=30;d.theta=Math.PI/6;d.phi=Math.PI/2.5;const{stats:h,gui:l}=v(t,{onReset:()=>n?.reset(),onSmoothingRadiusChange:()=>{}},{trackGPU:!0,title:"WebGPU 3D Fluid",subtitle:"SPH Fluid â€¢ Marching Cubes Reconstruction",features:["SPH Fluid Simulator (GPU)","Marching Cubes Meshing (Compute)","Indirect Instanced Drawing","Lambertian Shading","Dynamic Shadow Mapping","Box/Sphere Obstacles"],interactions:["Click & Drag (Background): Orbit Camera","Click & Drag (Fluid): Pull Particles","Shift + Click & Drag: Push Particles","Mouse Wheel: Zoom In/Out"],githubUrl:"https://github.com/jeantimex/fluid"}),C=l.folders.find(e=>e._title==="Performance");if(C){const e={mode:"Normal"};C.add(e,"mode",{Normal:"Normal",Slow:"Slow"}).name("Time Mode").onChange(a=>{t.timeScale=a==="Slow"?.4:2})}const c=l.addFolder("Marching Cubes");c.close();c.add(t,"densityTextureRes",32,256,1).name("Density Texture Res").onFinishChange(()=>n?.reset());c.add(t,"isoLevel",0,200,1).name("Iso Level");const L={surfaceColor:M(t.surfaceColor)};c.addColor(L,"surfaceColor").name("Surface Color").onChange(e=>{const a=R(e);t.surfaceColor.r=a.r/255,t.surfaceColor.g=a.g/255,t.surfaceColor.b=a.b/255});const S=l.folders.find(e=>e._title==="Shadow");S&&S.add(t,"showFluidShadows").name("Fluid Shadows");let f;const o={paused:!1,togglePause:()=>{o.paused=!o.paused,f&&f.name(o.paused?"Resume":"Pause")},reset:()=>n?.reset()};f=l.add(o,"togglePause").name(o.paused?"Resume":"Pause");l.add(o,"reset").name("Reset Simulation");async function G(){let e,a,s;try{({device:e,context:a,format:s}=await I(r))}catch(i){if(i instanceof T){g.innerHTML=`<p>${i.message}</p>`;return}throw i}m(a,e,s),n=new D(e,a,r,t,s);const b=W(r,()=>n?.simulationState.input,d,t);window.addEventListener("resize",()=>{const i=window.devicePixelRatio||1;r.width=window.innerWidth*i,r.height=window.innerHeight*i,m(a,e,s)});const p=window.devicePixelRatio||1;r.width=window.innerWidth*p,r.height=window.innerHeight*p,m(a,e,s);let u=null;const w=async i=>{u===null&&(u=i),h.begin();const P=Math.min(.033,(i-u)/1e3);u=i,b(),n&&(o.paused||await n.step(P),n.render(d)),h.end(),h.update(),requestAnimationFrame(w)};requestAnimationFrame(w)}G();
