import"./lil-gui.esm-DA0aiWCL.js";import{O as P,s as b,c as R,a as C,i as v,W as D,b as u,d as M}from"./picking_system-DXizyZhd.js";import{F as O}from"./fluid_simulation-Dj95IPxT.js";import"./main-DwTz-q1_.js";import"./splat_resolve-CMJnQc1h.js";function W(t){t.innerHTML='<canvas id="sim-canvas" aria-label="Fluid simulation"></canvas>';const a=document.querySelector("#sim-canvas");if(!a)throw new Error("Failed to create canvas element");return a}const p=document.querySelector("#app");if(!p)throw new Error("Missing #app container");const r=W(p),e={...C(),...R(),viscosityStrength:.01,iterationsPerFrame:2,nearPressureMultiplier:2.25,densityTextureRes:150,densityOffset:200,densityMultiplier:.05,stepSize:.02,lightStepSize:.1,renderScale:.5,maxSteps:512,indexOfRefraction:1.33,numRefractions:4,tileDarkOffset:-.35,extinctionCoefficients:{x:12,y:4,z:4},shadowSoftness:2.5,showFluidShadows:!0,showBoundsWireframe:!1,boundsWireframeColor:{r:1,g:1,b:1},obstacleColor:{r:1,g:0,b:0},obstacleAlpha:1};let n=null;const c=new P;c.radius=28;c.theta=.39;c.phi=1.27;const{stats:m,gui:l}=b(e,{onReset:()=>n?.reset(),onSmoothingRadiusChange:()=>{}},{trackGPU:!0,title:"WebGPU 3D Fluid",subtitle:"SPH Fluid • Volumetric Raymarching",features:["SPH Fluid Simulator (GPU)","Volumetric Density Splatting","Physically-Based Raymarching","Refraction & Reflection","Beer–Lambert Transmittance","Shadows & Ambient Occlusion"],interactions:["Click & Drag (Background): Orbit Camera","Click & Drag (Fluid): Pull Particles","Shift + Click & Drag: Push Particles","Mouse Wheel: Zoom In/Out"],githubUrl:"https://github.com/jeantimex/fluid"}),s=l.addFolder("Raymarch");s.close();s.add(e,"densityTextureRes",32,256,1).name("Density Texture Res").onFinishChange(()=>n?.reset());s.add(e,"densityOffset",0,400,1).name("Density Offset");s.add(e,"densityMultiplier",0,.2,.001).name("Density Multiplier");s.add(e,"renderScale",.1,1,.05).name("Render Scale");s.add(e,"stepSize",.01,.5,.01).name("Step Size");s.add(e,"maxSteps",32,2048,32).name("Max Steps");const y=l.folders.find(t=>t._title==="Shadow");y&&y.add(e,"showFluidShadows").name("Fluid Shadows");const h=s.addFolder("Extinction (Absorption)");h.add(e.extinctionCoefficients,"x",0,50,.1).name("Red");h.add(e.extinctionCoefficients,"y",0,50,.1).name("Green");h.add(e.extinctionCoefficients,"z",0,50,.1).name("Blue");let f;const o={paused:!1,togglePause:()=>{o.paused=!o.paused,f&&f.name(o.paused?"Resume":"Pause")},reset:()=>n?.reset()};f=l.add(o,"togglePause").name(o.paused?"Resume":"Pause");l.add(o,"reset").name("Reset Simulation");async function z(){let t,a,d;try{({device:t,context:a,format:d}=await v(r))}catch(i){if(i instanceof D){p.innerHTML=`<p>${i.message}</p>`;return}throw i}u(a,t,d),n=new O(t,a,r,e,d);const x=M(r,()=>n?.simulationState.input,c,e);window.addEventListener("resize",()=>{const i=window.devicePixelRatio||1;r.width=window.innerWidth*i,r.height=window.innerHeight*i,u(a,t,d)});const w=window.devicePixelRatio||1;r.width=window.innerWidth*w,r.height=window.innerHeight*w,u(a,t,d);let g=performance.now();const S=async i=>{m.begin();const F=Math.min(.033,(i-g)/1e3);g=i,x(),n&&(o.paused||await n.step(F),n.render(c)),m.end(),m.update(),requestAnimationFrame(S)};requestAnimationFrame(S)}z();
