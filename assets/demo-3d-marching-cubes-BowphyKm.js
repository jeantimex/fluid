import"./lil-gui.esm-DA0aiWCL.js";import{O as v,s as M,r as R,h as x,c as y,a as I,i as T,W,b as m,d as D}from"./picking_system-DbKB4hfE.js";import{F as H}from"./fluid_simulation-CahCODk0.js";import"./main-DwTz-q1_.js";import"./environment-ODazOT3W.js";import"./splat_resolve-CMJnQc1h.js";function L(e){e.innerHTML='<canvas id="sim-canvas" aria-label="Fluid simulation"></canvas>';const a=document.querySelector("#sim-canvas");if(!a)throw new Error("Failed to create canvas element");return a}const f=document.querySelector("#app");if(!f)throw new Error("Missing #app container");const n=L(f),t={...I(),...y(),viscosityStrength:.01,iterationsPerFrame:2,nearPressureMultiplier:2.25,densityTextureRes:150,isoLevel:75,surfaceColor:{r:15/255,g:91/255,b:234/255},shadowSoftness:2.5,showFluidShadows:!0,showBoundsWireframe:!1,boundsWireframeColor:{r:1,g:1,b:1}};let r=null;const d=new v;d.radius=30;d.theta=Math.PI/6;d.phi=Math.PI/2.5;const{stats:h,gui:l}=M(t,{onReset:()=>r?.reset(),onSmoothingRadiusChange:()=>{}},{trackGPU:!0,title:"WebGPU 3D Fluid",subtitle:"SPH Fluid â€¢ Marching Cubes Reconstruction",features:["SPH Fluid Simulator (GPU)","Marching Cubes Meshing (Compute)","Indirect Instanced Drawing","Lambertian Shading","Dynamic Shadow Mapping","Box/Sphere Obstacles"],interactions:["Click & Drag (Background): Orbit Camera","Click & Drag (Fluid): Pull Particles","Shift + Click & Drag: Push Particles","Mouse Wheel: Zoom In/Out"],githubUrl:"https://github.com/jeantimex/fluid"}),S=l.folders.find(e=>e._title==="Performance");if(S){const e={mode:"Normal"};S.add(e,"mode",{Normal:"Normal",Slow:"Slow"}).name("Time Mode").onChange(a=>{t.timeScale=a==="Slow"?.4:2})}const c=l.addFolder("Marching Cubes");c.close();c.add(t,"densityTextureRes",32,256,1).name("Density Texture Res").onFinishChange(()=>r?.reset());c.add(t,"isoLevel",0,200,1).name("Iso Level");const G={surfaceColor:R(t.surfaceColor)};c.addColor(G,"surfaceColor").name("Surface Color").onChange(e=>{const a=x(e);t.surfaceColor.r=a.r/255,t.surfaceColor.g=a.g/255,t.surfaceColor.b=a.b/255});const b=l.folders.find(e=>e._title==="Shadow");b&&b.add(t,"showFluidShadows").name("Fluid Shadows");let g;const o={paused:!1,togglePause:()=>{o.paused=!o.paused,g&&g.name(o.paused?"Resume":"Pause")},reset:()=>r?.reset()};g=l.add(o,"togglePause").name(o.paused?"Resume":"Pause");l.add(o,"reset").name("Reset Simulation");async function U(){let e,a,s,p;try{({device:e,context:a,format:s,supportsSubgroups:p}=await T(n))}catch(i){if(i instanceof W){f.innerHTML=`<p>${i.message}</p>`;return}throw i}m(a,e,s),r=new H(e,a,n,t,s,p);const P=D(n,()=>r?.simulationState.input,d,t);window.addEventListener("resize",()=>{const i=window.devicePixelRatio||1;n.width=window.innerWidth*i,n.height=window.innerHeight*i,m(a,e,s)});const w=window.devicePixelRatio||1;n.width=window.innerWidth*w,n.height=window.innerHeight*w,m(a,e,s);let u=null;const C=async i=>{u===null&&(u=i),h.begin();const F=Math.min(.033,(i-u)/1e3);u=i,P(),r&&(o.paused||await r.step(F),r.render(d)),h.end(),h.update(),requestAnimationFrame(C)};requestAnimationFrame(C)}U();
