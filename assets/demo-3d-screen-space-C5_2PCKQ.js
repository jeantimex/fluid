import"./lil-gui.esm-DA0aiWCL.js";import{O as F,s as P,c as R,a as v,i as E,W,b as p,d as L}from"./picking_system-B3C-PV4U.js";import{F as B}from"./fluid_simulation-B42dgUx9.js";import"./main-DwTz-q1_.js";import"./environment-ODazOT3W.js";function A(i){i.innerHTML='<canvas id="sim-canvas" aria-label="Fluid screen-space simulation"></canvas>';const n=document.querySelector("#sim-canvas");if(!n)throw new Error("Failed to create canvas element");return n}const g=document.querySelector("#app");if(!g)throw new Error("Missing #app container");const o=A(g),e={...v(),...R(),viscosityStrength:.01,iterationsPerFrame:2,foamSpawnRate:70,trappedAirVelocityMin:5,trappedAirVelocityMax:25,foamKineticEnergyMin:15,foamKineticEnergyMax:80,bubbleBuoyancy:1.4,bubbleScale:.3,foamLifetimeMin:10,foamLifetimeMax:30,waterColor:{r:.3,g:.9,b:.8},deepWaterColor:{r:.02,g:.15,b:.45},foamColor:{r:.95,g:.98,b:1},foamOpacity:2.5,sprayClassifyMaxNeighbours:5,bubbleClassifyMinNeighbours:15,foamParticleRadius:1,spawnRateFadeInTime:.75,spawnRateFadeStartTime:.1,bubbleChangeScaleSpeed:7,extinctionCoeff:{x:2.12,y:.43,z:.3},extinctionMultiplier:2.24,refractionStrength:9.15,shadowSoftness:2.5,showFluidShadows:!0,showBoundsWireframe:!1,boundsWireframeColor:{r:1,g:1,b:1},obstacleColor:{r:1,g:0,b:0},obstacleAlpha:1};let d=null;const m=new F;m.radius=30;m.theta=Math.PI/6;m.phi=Math.PI/2.5;const{stats:f,gui:l}=P(e,{onReset:()=>d?.reset(),onSmoothingRadiusChange:()=>{}},{trackGPU:!0,title:"WebGPU 3D Fluid",subtitle:"SPH Fluid â€¢ Screen-Space Rendering",features:["SPH Fluid Simulator (GPU)","Multi-Pass Screen-Space Renderer","Curvature-Flow Smoothing","Foam & Spray Simulation","Refraction & Beer-Lambert Law","Bilateral Depth Filtering"],interactions:["Click & Drag (Background): Orbit Camera","Click & Drag (Fluid): Pull Particles","Shift + Click & Drag: Push Particles","Mouse Wheel: Zoom In/Out"],githubUrl:"https://github.com/jeantimex/fluid"}),C=l.folders.find(i=>i._title==="Particles");C&&C.add(e,"particleRadius",1,5,.1).name("Particle Radius");const a=l.addFolder("Foam");a.close();a.add(e,"foamSpawnRate",0,1e3,1).name("Spawn Rate");a.add(e,"trappedAirVelocityMin",0,50,.1).name("Air Vel Min");a.add(e,"trappedAirVelocityMax",0,100,.1).name("Air Vel Max");a.add(e,"foamKineticEnergyMin",0,50,.1).name("Kinetic Min");a.add(e,"foamKineticEnergyMax",0,200,.1).name("Kinetic Max");a.add(e,"bubbleBuoyancy",0,5,.1).name("Buoyancy");a.add(e,"bubbleScale",0,2,.01).name("Scale");a.add(e,"foamLifetimeMin",0,30,.1).name("Lifetime Min");a.add(e,"foamLifetimeMax",0,60,.1).name("Lifetime Max");a.addColor(e,"foamColor").name("Color");a.add(e,"foamOpacity",0,20,.1).name("Opacity");a.add(e,"sprayClassifyMaxNeighbours",0,20,1).name("Spray Max Neighbors");a.add(e,"bubbleClassifyMinNeighbours",0,50,1).name("Bubble Min Neighbors");a.add(e,"foamParticleRadius",.1,5,.1).name("Particle Radius");a.add(e,"spawnRateFadeInTime",0,5,.01).name("Spawn Fade-In Time");a.add(e,"spawnRateFadeStartTime",0,5,.01).name("Spawn Fade Start");a.add(e,"bubbleChangeScaleSpeed",0,20,.1).name("Bubble Scale Speed");const r=l.addFolder("Screen Space");r.close();r.add(e.extinctionCoeff,"x",0,5,.01).name("Extinction R");r.add(e.extinctionCoeff,"y",0,5,.01).name("Extinction G");r.add(e.extinctionCoeff,"z",0,5,.01).name("Extinction B");r.add(e,"extinctionMultiplier",0,10,.01).name("Extinction Multiplier");r.add(e,"refractionStrength",0,20,.01).name("Refraction Strength");const M=l.folders.find(i=>i._title==="Shadow");M&&M.add(e,"showFluidShadows").name("Fluid Shadows");r.addColor(e,"waterColor").name("Water Color");r.addColor(e,"deepWaterColor").name("Deep Water Color");let b;const s={paused:!1,togglePause:()=>{s.paused=!s.paused,b&&b.name(s.paused?"Resume":"Pause")},reset:()=>d?.reset()};b=l.add(s,"togglePause").name(s.paused?"Resume":"Pause");l.add(s,"reset").name("Reset Simulation");async function I(){let i,n,c,h;try{({device:i,context:n,format:c,supportsSubgroups:h}=await E(o))}catch(t){if(t instanceof W){g.innerHTML=`<p>${t.message}</p>`;return}throw t}p(n,i,c),d=new B(i,n,o,e,c,h);const y=L(o,()=>d?.simulationState.input,m,e);window.addEventListener("resize",()=>{const t=window.devicePixelRatio||1;o.width=window.innerWidth*t,o.height=window.innerHeight*t,p(n,i,c)});const S=window.devicePixelRatio||1;o.width=window.innerWidth*S,o.height=window.innerHeight*S,p(n,i,c);let u=null;const w=async t=>{u===null&&(u=t),f.begin();const x=Math.min(.033,(t-u)/1e3);u=t,y(),d&&(s.paused||await d.step(x),d.render(m.viewMatrix)),f.end(),f.update(),requestAnimationFrame(w)};requestAnimationFrame(w)}I();
