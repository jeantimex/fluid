import{c as L,b as _,a as $,d as tt,s as et}from"./gui-DRYZ1KmF.js";function it(t,e,l){const i=t.getContext("2d");let n=i.createImageData(t.width,t.height),o=n.data,p=null,d=t.width/e.boundsSize.x,y=t.width*.5,g=t.height*.5,r=-1,c=[];function k(){const a=t.getBoundingClientRect(),u=window.devicePixelRatio||1,f=Math.max(1,Math.round(a.width*u)),w=Math.max(1,Math.round(a.height*u));if(p===null){const h=Math.max(1,a.width);p=e.boundsSize.x/h}(t.width!==f||t.height!==w)&&(t.width=f,t.height=w,n=i.createImageData(t.width,t.height),o=n.data),e.boundsSize={x:t.width/u*p,y:t.height/u*p},d=t.width/e.boundsSize.x,y=t.width*.5,g=t.height*.5}function P(a,u){return{x:y+a*d,y:g-u*d}}function X(a,u){const f=window.devicePixelRatio||1,w=a*f,h=u*f;return{x:(w-y)/d,y:(g-h)/d}}function Y(){const a=window.devicePixelRatio||1,u=Math.max(1,Math.round(e.particleRadius*a));if(u===r)return;r=u;const f=[],w=r*r;for(let h=-r;h<=r;h+=1)for(let m=-r;m<=r;m+=1)m*m+h*h<=w&&f.push([m,h]);c=f}function B(a){const u=t.width,f=t.height;o.fill(0);const w=[5,7,11];for(let s=0;s<o.length;s+=4)o[s]=w[0],o[s+1]=w[1],o[s+2]=w[2],o[s+3]=255;const h=e.velocityDisplayMax;Y();for(let s=0;s<a.count;s+=1){const b=a.positions[s*2],A=a.positions[s*2+1],O=P(b,A),W=a.velocities[s*2],v=a.velocities[s*2+1],G=Math.sqrt(W*W+v*v),K=Math.max(0,Math.min(1,G/h)),j=Math.min(l.length-1,Math.floor(K*(l.length-1))),R=l[j],Z=Math.round(R.r*255),J=Math.round(R.g*255),N=Math.round(R.b*255),Q=Math.round(O.x),V=Math.round(O.y);for(let F=0;F<c.length;F+=1){const I=c[F],C=V+I[1];if(C<0||C>=f)continue;const z=Q+I[0];if(z<0||z>=u)continue;const M=(C*u+z)*4;o[M]=Z,o[M+1]=J,o[M+2]=N,o[M+3]=255}}i.putImageData(n,0,0);const m=e.boundsSize.x*d/2,H=e.boundsSize.y*d/2;if(i.strokeStyle="#1b2432",i.lineWidth=1,i.strokeRect(y-m,g-H,m*2,H*2),e.obstacleSize.x>0&&e.obstacleSize.y>0){const s=e.obstacleSize.x*d/2,b=e.obstacleSize.y*d/2,A=P(e.obstacleCentre.x,e.obstacleCentre.y);i.strokeStyle="#36516d",i.strokeRect(A.x-s,A.y-b,s*2,b*2)}}return k(),window.addEventListener("resize",k),{draw:B,worldToCanvas:P,canvasToWorld:X,getScale:()=>d}}function nt(t){const e=t.count;return{positions:t.positions,predicted:new Float32Array(t.positions),velocities:t.velocities,densities:new Float32Array(e*2),keys:new Uint32Array(e),sortedKeys:new Uint32Array(e),indices:new Uint32Array(e),sortOffsets:new Uint32Array(e),spatialOffsets:new Uint32Array(e),positionsSorted:new Float32Array(e*2),predictedSorted:new Float32Array(e*2),velocitiesSorted:new Float32Array(e*2),count:e,input:{worldX:0,worldY:0,pull:!1,push:!1}}}function ot(t,e,l){const i=n=>{const o=t.getBoundingClientRect(),p=n.clientX-o.left,d=n.clientY-o.top,y=e(p,d);l.worldX=y.x,l.worldY=y.y};t.addEventListener("pointermove",i),t.addEventListener("pointerdown",n=>{i(n),n.button===0&&(l.pull=!0),n.button===2&&(l.push=!0)}),t.addEventListener("pointerup",n=>{n.button===0&&(l.pull=!1),n.button===2&&(l.push=!1)}),t.addEventListener("pointerleave",()=>{l.pull=!1,l.push=!1}),t.addEventListener("contextmenu",n=>{n.preventDefault()})}function st(t){const e=tt(),l=L(e),i=nt(l),n=_(e.colorKeys,e.gradientResolution),o=it(t,e,n);ot(t,o.canvasToWorld,i.input);const p=$(i,e,o.getScale);function d(){const r=L(e),c=r.count;i.positions=r.positions,i.predicted=new Float32Array(r.positions),i.velocities=r.velocities,i.densities=new Float32Array(c*2),i.keys=new Uint32Array(c),i.sortedKeys=new Uint32Array(c),i.indices=new Uint32Array(c),i.sortOffsets=new Uint32Array(c),i.spatialOffsets=new Uint32Array(c),i.positionsSorted=new Float32Array(c*2),i.predictedSorted=new Float32Array(c*2),i.velocitiesSorted=new Float32Array(c*2),i.count=c}function y(r){p.step(r)}function g(){o.draw(i)}return{step:y,draw:g,state:i,config:e,refreshSettings:p.refreshSettings,applyParticleScale:p.applyParticleScale,reset:d}}document.querySelector("#app").innerHTML=`
  <canvas id="sim-canvas" aria-label="Fluid simulation"></canvas>
`;const rt=document.querySelector("#sim-canvas"),S=st(rt);let D;const x={paused:!1,togglePause:()=>{x.paused=!x.paused,D&&D.name(x.paused?"Resume":"Pause")},reset:()=>S.reset()},{stats:U,gui:q}=et(S.config,{onReset:()=>S.reset(),onSmoothingRadiusChange:()=>S.refreshSettings()},{trackGPU:!1,title:"Canvas 2D Fluid",subtitle:"SPH Fluid â€¢ Particle Simulation",features:["SPH Fluid Simulator","Canvas 2D Rendering","Direct Pixel Manipulation","Spatial Grid Optimization","Box Obstacle Interaction"],interactions:["Click & Drag: Pull Particles","Right Click & Drag: Push Particles","Mouse Wheel: Zoom In/Out"],githubUrl:"https://github.com/jeantimex/fluid"});D=q.add(x,"togglePause").name(x.paused?"Resume":"Pause");q.add(x,"reset").name("Reset Simulation");let E=performance.now();function T(t){U.begin();const e=Math.min(.033,(t-E)/1e3);E=t,x.paused||S.step(e),S.draw(),U.end(),U.update(),requestAnimationFrame(T)}requestAnimationFrame(T);
